<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Safe Driving Awareness App</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
</head>
<body>
<!-- Breadcrumbs -->
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item" th:each="crumb : ${breadcrumbs}">
            <a th:if="${crumb == 'Configurator'}" th:text="${crumb}" href="/configurator"></a>
            <a th:unless="${crumb == 'Configurator'}" th:text="${crumb}"></a>
        </li>
    </ol>
</nav>
<div class="d-flex justify-content">
    <p class="m-2">Choose speed increase percentage:</p>
    <div th:each="speedIncreaseOption: ${speedIncreaseOptions}" class="form-check m-2">
        <input th:id="'speedIncreaseRadioBtn' + ${speedIncreaseOption}"
               th:value="${speedIncreaseOption}"
               class="form-check-input"
               type="radio"
               name="speedIncreaseRadioBtn">
<!--               data-bs-toggle="collapse"-->
<!--               data-bs-target="#collapseDiv"-->
<!--               aria-controls="collapseDiv">-->
        <label class="form-check-label"
               th:for="'speedIncreaseRadioBtn' + ${speedIncreaseOption}"
               th:text="'+' + ${speedIncreaseOption} + '%'">
        </label>
    </div>
</div>
<div id="collapseDiv" class="collapse">
    <div id="infoDiv" class="d-flex flex-row">
        <div id="speedLimitsCard" class="card m-2 w-50">
            <div class="card-header">
                Speed limits used
            </div>
            <div class="card-body">
                <h6 class="card-title">These are the new speed values on different road types which will be used to calculate your route:</h6>
                <ul class="list-group list-group-flush">
                    <li th:each="entry: ${speedLimits}" class="list-group-item">
                        <span th:text="${entry.key.displayText}"></span>: <span th:text="${entry.value}"></span>
                    </li>
                </ul>
            </div>
        </div>
        <div id="penaltiesCard" class="card m-2 flex-grow-1">
            <div class="card-header">
                Penalties
            </div>
            <p>penalties</p>
        </div>
    </div>
</div>
<button class="btn btn-primary" type="submit">Next</button>

<script>
    var selectedOption = undefined;

    function showCollapse() {
        let element = document.querySelector('#collapseDiv');
        let bsCollapse = bootstrap.Collapse.getInstance(element);
        if (bsCollapse === null) {
            bsCollapse = new bootstrap.Collapse(element, {
                toggle: false
            })
        }
        bsCollapse.show();
    }

    $(document).ready(function () {
        $("#speedIncreaseRadioBtn0").on('click', function () {
            var inputValue = $('#speedIncreaseRadioBtn0').val();
            console.log("inputValue=" + inputValue + "\nselectedOption=" + selectedOption);
            if (inputValue != selectedOption) {
                $.get('/configurator/speed-info', { option: inputValue }).done(function (fragment) {
                    $("#infoDiv").replaceWith(fragment);
                });
                showCollapse();
            }
            selectedOption = inputValue;
        }),
            $("#speedIncreaseRadioBtn10").on('click', function () {
                var inputValue = $('#speedIncreaseRadioBtn10').val();
                if (inputValue != selectedOption) {
                    $.get('/configurator/speed-info', { option: inputValue }).done(function (fragment) {
                        $("#infoDiv").replaceWith(fragment);
                    });
                    showCollapse();
                }
                showCollapse();
                selectedOption = inputValue;
            })
    });
</script>

</body>
</html>